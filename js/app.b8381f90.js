(function(t){function e(e){for(var i,s,o=e[0],c=e[1],l=e[2],d=0,h=[];d<o.length;d++)s=o[d],r[s]&&h.push(r[s][0]),r[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(i=!1)}i&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},r={app:0},a=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/achtung/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var i=n("64a9"),r=n.n(i);r.a},1:function(t,e){},"31aa":function(t,e,n){},"331a":function(t,e,n){},"36a1":function(t,e,n){"use strict";var i=n("f717"),r=n.n(i);r.a},"4ab0":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var i=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},a=[],s=(n("034f"),n("2877")),o={},c=Object(s["a"])(o,r,a,!1,null,null,null);c.options.__file="App.vue";var l=c.exports,u=n("9483");Object(u["a"])("".concat("/achtung/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});var d=n("8c4f"),h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[t.id&&t.device?n("Achtung",{class:{blur:t.blur},attrs:{client:t.client}}):t.id?n("DeviceForm",{class:{blur:t.blur},attrs:{client:t.client}}):n("div",{staticClass:"joining"},[n("span",[t._v("Joining session...")])]),n("router-view")],1)},f=[],v=(n("7f7f"),n("cebc")),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"game"},[n("canvas",{ref:"canvas",staticClass:"canvas",class:{playing:t.playing,was_playing:t.was_playing,hide_overlay:t.hide_overlay},on:{click:function(e){t.setHideOverlay(!1)}}}),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.hide_overlay,expression:"!hide_overlay"}],staticClass:"grid"},[t._l(t.gamepad_groups,function(e){var i=e.align,r=e.max_size,a=e.flip;return n("div",{key:i,staticClass:"game-pad-group",class:[i,{outline:!t.playing&&!t.controller_lock}],on:{click:function(e){if(e.target!==e.currentTarget)return null;t.maybeAddPlayer(e,i,r)}}},t._l(t.playersForSide(i),function(e){var i=e.player_id,r=e.align,s=e.offset,o=e.color;return n("div",{key:i,staticClass:"game-pad",class:{flip:a},style:t.gamePadStyle(r,s,o.value),on:{click:function(e){t.maybeRemovePlayer(i)}}},[n("span",{staticClass:"icon icon-left-nav",attrs:{id:"left"},on:{touchstart:function(e){e.stopPropagation(),t.playing&&t.game.turn_left(i)},mousedown:function(e){e.stopPropagation(),t.playing&&t.game.turn_left(i)},touchend:function(e){e.stopPropagation(),t.playing&&t.game.stop_turn(i)},mouseup:function(e){e.stopPropagation(),t.playing&&t.game.stop_turn(i)},contextmenu:function(t){t.preventDefault()}}},[t._v("➡")]),n("span",{staticClass:"icon icon-right-nav",attrs:{id:"right"},on:{touchstart:function(e){e.stopPropagation(),t.playing&&t.game.turn_right(i)},mousedown:function(e){e.stopPropagation(),t.playing&&t.game.turn_right(i)},touchend:function(e){e.stopPropagation(),t.playing&&t.game.stop_turn(i)},mouseup:function(e){e.stopPropagation(),t.playing&&t.game.stop_turn(i)},contextmenu:function(t){t.preventDefault()}}},[t._v("➡")])])}),0)}),n("transition",{attrs:{name:"fade"}},[t.playing||t.hide_overlay?t._e():n("div",{staticClass:"overlay",class:{was_playing:t.was_playing}},[n("h1",[t._v("Achtung, die Kurve!")]),n("div",{staticClass:"menu"},[n("div",{staticClass:"button"},[n("div",{staticClass:"vr"}),n("router-link",{attrs:{to:{name:"config"}}},[t._v("Devices")]),n("div",{staticClass:"vr"})],1),t.controller_lock?n("div",{staticClass:"button"},[n("div",{staticClass:"vr"}),n("button",{on:{click:function(e){t.controller_lock=!1}}},[t._v("Edit players")]),n("div",{staticClass:"vr"})]):t._e(),n("div",{staticClass:"button"},[n("div",{staticClass:"vr"}),n("button",{on:{click:t.requestFullscreen}},[t._v("Fullscreen")]),n("div",{staticClass:"vr"})]),t.start_allowed&&!t.score?n("div",{staticClass:"button"},[n("div",{staticClass:"vr"}),n("button",{on:{click:t.startAll}},[t._v("Start game")]),n("div",{staticClass:"vr"})]):t._e(),t.score?n("div",{staticClass:"button"},[n("div",{staticClass:"vr"}),n("button",{on:{click:function(e){t.setHideOverlay(!0)}}},[t._v("Show gameboard")]),n("div",{staticClass:"vr"})]):t._e(),t.start_allowed&&t.score?n("div",{staticClass:"button"},[n("div",{staticClass:"vr"}),n("button",{on:{click:t.startAll}},[t._v("Next round")]),n("div",{staticClass:"vr"})]):t._e()]),t.start_allowed?t._e():n("div",{staticClass:"player-controller-hint"},[t._v("\n          Place controllers anywhere on the side of all devices.\n        ")]),t.score?n("div",{staticClass:"scoreboard"},[n("h3",[t._v("===  Score  ===")]),n("ol",t._l(t.player_scores,function(e,i){var r=e.points,a=e.worm;return n("li",{key:i},[n("div",{staticClass:"item"},[n("span",{staticClass:"color-indicator",style:{background:a.color}}),n("span",{staticClass:"name"},[t._v("\n                  "+t._s(a.name)+"\n                  "),a==t.winner?[t._v("*")]:t._e()],2),n("span",{staticClass:"points"},[t._v(t._s(r))])])])}),0)]):t._e()])])],2)])},m=[],y=(n("14b9"),n("2d1f")),g=n.n(y),_=n("2d7d"),b=n.n(_),w=n("0a0d"),k=n.n(w),j=n("bd86"),x=n("75fc"),O=(n("55dd"),n("a4bb")),C=n.n(O),P=n("768b"),S=n("2f62"),M=n("5d73"),$=n.n(M),D=(n("ac6a"),n("b6d0")),F=n.n(D),B=n("d225"),A=n("b0b4"),I=function(){function t(){Object(B["a"])(this,t),this.results=[{}]}return Object(A["a"])(t,[{key:"commit",value:function(){this.results.push({})}},{key:"add",value:function(t,e){var n=this.results[this.results.length-1];n[t]=(n[t]||0)+e}},{key:"set",value:function(t,e){var n=this.results[this.results.length-1],i=e!==n[t];return n[t]=e,i}},{key:"max",value:function(){var t=this;return C()(this.result).reduce(function(e,n){return Math.max(e,t.result[n])},0)}},{key:"getTotalResult",value:function(){var t=g()(this.results.reduce(function(t,e){return C()(e).forEach(function(n){return t[n]=(t[n]||0)+e[n]}),t},{}));return t.sort(function(t,e){return e[1]-t[1]}),t}}]),t}(),H=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(B["a"])(this,t),this.reset(e)}return Object(A["a"])(t,[{key:"reset",value:function(t){this.seed=t}},{key:"next",value:function(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280}},{key:"range",value:function(t,e){return t=t||0,e=e||1,t+this.next()*(e-t)}},{key:"color",value:function(t){var e=this.range(0,t),n=Math.floor(e)%4;switch(n){case 0:return"#FF0000";case 1:return"cyan";case 2:return"lime";case 3:return"yellow";default:return"white"}}}]),t}(),E=n("308d"),q=n("6bb5"),W=n("4e2b"),R=n("f28b");function L(t){var e=0,n=!0,i=!1,r=void 0;try{for(var a,s=$()(t);!(n=(a=s.next()).done);n=!0){var o=a.value;o[0]+=e,e=o[0]}}catch(c){i=!0,r=c}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return t}var T=function(t){function e(t){var n;Object(B["a"])(this,e);var i=L(t);return n=Object(E["a"])(this,Object(q["a"])(e).call(this,i)),n.max=Object(x["a"])(i).slice(-1)[0][0],n}return Object(W["a"])(e,t),Object(A["a"])(e,[{key:"get",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=$()(this);!(e=(r=a.next()).done);e=!0){var s=Object(P["a"])(r.value,2),o=s[0],c=s[1];if(o>t)return c}}catch(l){n=!0,i=l}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return null}}]),e}(Object(R["a"])(b.a)),N=(n("673e"),function(){function t(e,n){Object(B["a"])(this,t),this.x=e,this.y=void 0!==n?n:e}return Object(A["a"])(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"sub",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"mul",value:function(e){return new t(this.x*e,this.y*e)}},{key:"div",value:function(e){return new t(this.x/e,this.y/e)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}}]),t}()),G=1,z=2,J=3,U=4,Y=function(t,e){return t.x*e.y-t.y*e.x},K=0,X=function(){function t(e,n,i,r,a,s){Object(B["a"])(this,t),this.width=e,this.height=n,this.random=new H,this.name=a,this.color=s,this.speed=.1,this.is_dead=!1,this.tail=[],this.skip=0,this.start(i,r,0)}return Object(A["a"])(t,[{key:"start",value:function(t,e,n){this.position=t,this.direction=e,this.turning=n,this.add_tail_point(!0)}},{key:"set_turning",value:function(t){this.add_tail_point(),this.turning=t}},{key:"kill",value:function(){this.add_tail_point(),this.is_dead=!0}},{key:"head",value:function(){return this.tail[this.tail.length-1]}},{key:"add_tail_point",value:function(t){if(this.skip>0)return null;var e=this.create_tail_point(this.position,this.direction,t);return this.tail.push(e),e}},{key:"create_tail_point",value:function(t,e,n){var i={position:t,direction:e,is_start:n};return n||this.calculate_control_points(this.head(),i),i}},{key:"create_collition_points",value:function(t){var e=[].concat(Object(x["a"])(this.tail),[this.create_tail_point(this.position,this.direction)]);return e.slice(0,t?-2:void 0)}},{key:"calculate_control_points",value:function(t,e){var n=e.direction-t.direction;if(0!==n){var i=t.direction+Math.PI/2,r=e.direction+Math.PI/2,a=new N(Math.cos(i),Math.sin(i)),s=new N(Math.cos(r),Math.sin(r)),o=Y(e.position.sub(t.position),s)/Y(a,s),c=o*Math.tan(n/Math.PI);e.cp1=t.position.add(new N(c*Math.cos(t.direction),c*Math.sin(t.direction))),e.cp2=e.position.sub(new N(c*Math.cos(e.direction),c*Math.sin(e.direction)))}}},{key:"update",value:function(t,e){if(this.is_dead)return!1;this.skip<=0&&this.random.next()<K?(this.add_tail_point(),this.skip=250):this.skip>0&&(this.skip-=t,this.skip<0&&this.add_tail_point(!0));var n=t*this.speed,i=new N(n*Math.cos(this.direction),n*Math.sin(this.direction));this.position=this.position.add(i),this.direction+=.04*n*this.turning;var r=Math.abs(this.head().direction-this.direction);return r>Math.PI/2&&this.add_tail_point(),this.position.x<0?!this.transfer(e,z):this.position.x>this.width?!this.transfer(e,J):this.position.y<0?!this.transfer(e,G):!(this.position.y>this.height)||!this.transfer(e,U)}},{key:"transfer",value:function(t,e){return this.add_tail_point(),t(e)}},{key:"draw",value:function(t){if(this.tail.length){t.strokeStyle=this.color,t.beginPath();var e=!0,n=!1,i=void 0;try{for(var r,a=$()(this.tail);!(e=(r=a.next()).done);e=!0){var s=r.value;this.draw_segment(t,s)}}catch(o){n=!0,i=o}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}this.draw_segment(t,this.create_tail_point(this.position,this.direction),!0),t.stroke()}}},{key:"draw_segment",value:function(t,e){e.cp1?t.bezierCurveTo(e.cp1.x,e.cp1.y,e.cp2.x,e.cp2.y,e.position.x,e.position.y):e.is_start?t.moveTo(e.position.x,e.position.y):t.lineTo(e.position.x,e.position.y)}}]),t}(),Q=function(t,e,n,i,r){var a=1-r,s=a*a,o=r*r;return t.mul(a*s).add(e.mul(3*s*r)).add(n.mul(3*a*o)).add(i.mul(r*o))},V=function(t,e){return t.x*e.x+t.y*e.y},Z=function(){function t(){Object(B["a"])(this,t)}return Object(A["a"])(t,null,[{key:"bezier_dist2",value:function(t,e,n,i,r){for(var a=1/0,s=0;s<1;s+=.2)a=Math.min(a,Q(t,e,n,i,s).sub(r).len2());return a}},{key:"line_dist2",value:function(t,e,n){var i=e.sub(t),r=n.sub(t),a=V(i,r)/i.len2();return a<0?1/0:a>1?1/0:r.sub(i.mul(a)).len2()}}]),t}(),tt=0,et=1,nt=2,it=3,rt=.2;function at(t){return 5-t}var st=function(){function t(e,n,i,r,a,s,o,c,l){Object(B["a"])(this,t),this.ctx=e,this.score=new I,this.local_id=n,this.send_message=i,this.get_players=r,this.get_adjacent_device=a,this.get_offset=s,this.get_device_area=o,this.on_score_updated=c,this.on_game_over=l}return Object(A["a"])(t,[{key:"requestFrame",value:function(){var t=this;requestAnimationFrame(function(e){return t.main_loop(e)})}},{key:"resetScore",value:function(){this.score=new I}},{key:"start",value:function(t){var e=this;this.worms=new b.a,this.worm_devices=new b.a,this.score.commit(),this.width=this.ctx.canvas.width=window.innerWidth,this.height=this.ctx.canvas.height=window.innerHeight;var n=new H(t);this.players=this.get_players();var i=new T(Object(x["a"])(new F.a(this.players.values())).map(function(t){var n=t.device_id;return[e.get_device_area(n),n]})),r=!0,a=!1,s=void 0;try{for(var o,c=$()(this.players.entries());!(r=(o=c.next()).done);r=!0){var l=Object(P["a"])(o.value,2),u=l[0],d=l[1].color,h=new N(n.range(rt*this.width,(1-rt)*this.width),n.range(rt*this.height,(1-rt)*this.height)),f=n.range(-Math.PI,Math.PI);this.worms.set(u,new X(this.width,this.height,h,f,d.name,d.value));var v=i.get(n.range(0,i.max));this.worm_devices.set(u,v),this.score.set(u,0)}}catch(p){a=!0,s=p}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}this.on_score_updated(this.score.getTotalResult()),this.elapsed_time=0,this.max_fps=30,this.game_over=!1,this.game_time=performance.now(),this.requestFrame()}},{key:"main_loop",value:function(t){t<this.game_time+1e3/this.max_fps?this.requestFrame():(this.elapsed_time=t-this.game_time,this.game_time=t,this.update(),this.draw(),this.game_over||this.requestFrame())}},{key:"on_message",value:function(t,e){switch(e.type){case tt:return void this.worms.get(e.controller_id).set_turning(e.turning);case et:var n=this.worms.get(e.controller_id),i=e.position,r=i.x,a=i.y,s=new N(r,a).add(this.get_offset(e.side));return n.start(s,e.direction,e.turning),void this.send_message(0,{type:nt,controller_id:e.controller_id,device_id:this.local_id});case nt:return void this.worm_devices.set(e.controller_id,e.device_id);case it:return void this.worms.get(e.controller_id).kill()}}},{key:"turn_left",value:function(t){return this.turn(t,-1)}},{key:"turn_right",value:function(t){return this.turn(t,1)}},{key:"stop_turn",value:function(t){return this.turn(t,0)}},{key:"turn",value:function(t,e){return this.send_message(this.worm_devices.get(t),{type:tt,controller_id:t,turning:e}),!0}},{key:"transfer",value:function(t,e,n){var i=this.get_adjacent_device(n);if(i){var r=e.position,a=r.x,s=r.y;return this.worm_devices.set(t,i),this.send_message(i,{type:et,controller_id:t,position:{x:a,y:s},side:at(n),direction:e.direction,turning:e.turning}),!0}return this.kill_worm(t),!1}},{key:"kill_worm",value:function(t){this.send_message(0,{type:it,controller_id:t})}},{key:"update",value:function(){var t=this,e=!0,n=!1,i=void 0;try{for(var r,a=function(){var e=Object(P["a"])(r.value,2),n=e[0],i=e[1];if(t.worm_devices.get(n)!==t.local_id)return"continue";var a=i.update(t.elapsed_time,function(e){return t.transfer(n,i,e)});a&&t.check_collision(i)&&t.kill_worm(n)},s=$()(this.worms);!(e=(r=s.next()).done);e=!0)a()}catch(g){n=!0,i=g}finally{try{e||null==s.return||s.return()}finally{if(n)throw i}}var o=Object(x["a"])(this.worms.values()).filter(function(t){return t.is_dead}),c=[],l=!1,u=!0,d=!1,h=void 0;try{for(var f,v=$()(this.worms);!(u=(f=v.next()).done);u=!0){var p=Object(P["a"])(f.value,2),m=p[0],y=p[1];y.is_dead||(l|=this.score.set(m,o.length),c.push(y))}}catch(g){d=!0,h=g}finally{try{u||null==v.return||v.return()}finally{if(d)throw h}}l&&this.on_score_updated(this.score.getTotalResult()),c.length<=1&&(this.game_over=!0,this.on_game_over(c[0]))}},{key:"check_collision",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=$()(this.worms.values());!(e=(r=a.next()).done);e=!0){var s=r.value,o=s.tail[0],c=!0,l=!1,u=void 0;try{for(var d,h=$()(s.create_collition_points(s===t));!(c=(d=h.next()).done);c=!0){var f=d.value;if(!f.is_start){var v=f.cp1?Z.bezier_dist2(o.position,f.cp1,f.cp2,f.position,t.position):Z.line_dist2(o.position,f.position,t.position);if(v<25)return!0}o=f}}catch(p){l=!0,u=p}finally{try{c||null==h.return||h.return()}finally{if(l)throw u}}}}catch(p){n=!0,i=p}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return!1}},{key:"draw",value:function(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.lineWidth=5;var t=!0,e=!1,n=void 0;try{for(var i,r=$()(this.worms.values());!(t=(i=r.next()).done);t=!0){var a=i.value;a.draw(this.ctx)}}catch(s){e=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}}}]),t}(),ot=1,ct=2,lt=3,ut=4,dt={name:"Achtung",props:{client:Object},data:function(){return{callbacks:null,sessionId:"1234",game:null,score:null,winner:null,playerSequenceNumber:0,playing:!1,was_playing:!1,controller_lock:!1,hide_overlay:!1}},computed:Object(v["a"])({},Object(S["d"])(["id"]),Object(S["b"])(["findById","findByPosition","getPlayersForDevice"]),{device:function(){return this.findById(this.id)},gamepad_groups:function(){var t=this;if(!this.device)return[];var e=this.device,n=e.x,i=e.y;return[[n,i-1,"top",2,!0],[n-1,i,"left",3,!1],[n+1,i,"right",3,!0],[n,i+1,"bottom",2,!1]].filter(function(e){var n=Object(P["a"])(e,2),i=n[0],r=n[1];return!t.findByPosition(i,r)}).map(function(t){var e=Object(P["a"])(t,5),n=e[2],i=e[3],r=e[4];return{max_size:i,align:n,flip:r}})},local_players:function(){return this.getPlayersForDevice(this.id)},start_allowed:function(){return this.game&&C()(this.$store.state.achtung.players).length>1},canvas_style:function(){return{opacity:this.playing||this.hide_overlay?1:.15}},player_scores:function(){var t=this;return this.score.map(function(e){var n=Object(P["a"])(e,2),i=n[0],r=n[1],a=t.game.worms.get(i);return{points:r,worm:a}})},playersForSide:function(){var t=this;return function(e){var n=t.local_players.filter(function(t){return t.align===e});if(!n.length)return[];n.sort(function(t,e){return t.offset-e.offset});for(var i="left"===e||"right"===e,r=i?window.innerHeight:window.innerWidth,a=[{offset:-100}].concat(Object(x["a"])(n),[{offset:r-20}]),s=function(t,e,n){return Math.max(t.offset+160,Math.min(e.offset,n.offset-160))},o=0;o<n.length;++o)n[o].offset=s.apply(void 0,Object(x["a"])(a.slice(o,o+3)));return n}},gamePadStyle:function(){var t=function(t){return/^top|bottom$/.test(t)?"X":"Y"};return function(e,n,i){return{transform:"translate".concat(t(e),"(").concat(n,"px)"),backgroundColor:i}}}}),mounted:function(){var t,e=this;this.callbacks=this.client.createCallbacks((t={$join:function(){return e.resetScore()},$left:function(){return e.resetScore()}},Object(j["a"])(t,"config:open",function(){return e.$router.push({name:"config"})}),Object(j["a"])(t,"achtung:overlay",function(t){var n=t.hide_overlay;e.hide_overlay=n,e.was_playing=!1}),Object(j["a"])(t,"achtung:reset",function(){return e.resetScore()}),Object(j["a"])(t,"achtung:start",function(t){var n=t.seed;return e.start(n)}),Object(j["a"])(t,"achtung:message",function(t){return e.onMessage(t)}),t)),this.maybeCreateGame()},beforeDestroy:function(){this.client.resetCallbacks(this.callbacks),delete this.game},watch:{id:function(){this.maybeCreateGame()}},methods:{resetAllScore:function(){this.client.send("achtung:reset"),this.resetScore()},startAll:function(){var t=k()();this.client.send("achtung:start",{seed:t}),this.start(t)},setHideOverlay:function(t){t!==this.hide_overlay&&(this.client.send("achtung:overlay",{hide_overlay:t}),this.hide_overlay=t,this.was_playing=!1)},resetScore:function(){this.score=null,this.game.resetScore()},start:function(t){this.game&&(this.playing=!0,this.controller_lock=!0,this.game.start(t))},maybeAddPlayer:function(t,e,n){if(!this.playing&&!this.controller_lock&&this.playersForSide(e).length!=n){var i="".concat(this.id,"#").concat(++this.playerSequenceNumber),r=this.id,a="left"===e||"right"===e,s=(a?t.clientY:t.clientX)-80;this.resetAllScore(),this.$store.dispatch("addPlayer",{player_id:i,device_id:r,align:e,offset:s})}},maybeRemovePlayer:function(t){this.playing||this.controller_lock||(this.resetAllScore(),this.$store.dispatch("removePlayer",t))},onMessage:function(t){var e=t.sender,n=t.receiver,i=t.payload;!this.game||0!==n&&n!==this.id||this.game.on_message(e,i)},onGameOver:function(t){this.winner=t,this.playing=!1,this.was_playing=!0},maybeCreateGame:function(){var t=this;this.game||(this.game=new st(this.$refs.canvas.getContext("2d"),this.id,function(e,n){e!==t.id&&0!==e||t.game.on_message(t.id,n),e!==t.id&&t.client.send("achtung:message",{sender:t.id,receiver:e,payload:n})},function(){var e=t.$store.state.achtung.players;return new b.a(g()(e).filter(function(e){return t.findById(e[1].device_id)}))},function(e){var n=t.device,i=n.x,r=n.y,a=null;switch(e){case ot:a=t.findByPosition(i,r-1);break;case ct:a=t.findByPosition(i-1,r);break;case lt:a=t.findByPosition(i+1,r);break;case ut:a=t.findByPosition(i,r+1);break}return a?a.id:null},function(e){var n=t.device,i=n.x,r=n.y;switch(e){case ot:return new N(0,-t.findByPosition(i,r-1).deviceHeight);case ct:return new N(-t.findByPosition(i-1,r).deviceWidth,0);case lt:return new N(t.device.deviceWidth,0);case ut:return new N(0,t.device.deviceHeight)}},function(e){var n=t.findById(e);return n?n.deviceWidth*n.deviceHeight:0},function(e){return t.score=e},function(e){return t.onGameOver(e)}),window.addEventListener("keydown",function(e){t.playing&&!e.repeat&&(39===e.keyCode?t.game.turn_right(t.local_players[0].player_id):37===e.keyCode&&t.game.turn_left(t.local_players[0].player_id))}),window.addEventListener("keyup",function(e){!t.playing||39!==e.keyCode&&37!==e.keyCode||t.game.stop_turn(t.local_players[0].player_id)}))},requestFullscreen:function(){document.body.requestFullscreen()}}},ht=dt,ft=(n("ffc2"),Object(s["a"])(ht,p,m,!1,null,"50b46340",null));ft.options.__file="Achtung.vue";var vt=ft.exports,pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"device-form config-nav"},[n("h1",[t._v("Achtung, die Kurve!")]),n("p",[t._v("Anim velit consequat aute dolore est labore elit nulla dolore dolore officia nostrud ullamco enim enim.")]),n("router-link",{attrs:{to:{name:"config"}}},[t._v("Setup devices")])],1)},mt=[],yt={props:{client:Object},data:function(){return{callbacks:null}},mounted:function(){var t=this;this.callbacks=this.client.createCallbacks(Object(j["a"])({},"config:open",function(){return t.$router.push({name:"config"})}))},beforeDestroy:function(){this.client.resetCallbacks(this.callbacks)}},gt=yt,_t=(n("8724"),Object(s["a"])(gt,pt,mt,!1,null,"27a0c63d",null));_t.options.__file="DeviceForm.vue";var bt=_t.exports,wt={name:"home",components:{Achtung:vt,DeviceForm:bt},props:{client:Object},computed:Object(v["a"])({blur:function(){return"config"===this.$route.name}},Object(S["d"])(["id"]),Object(S["b"])(["findById"]),{device:function(){return this.findById(this.id)}})},kt=wt,jt=(n("8a8b"),Object(s["a"])(kt,h,f,!1,null,"a47b5c16",null));jt.options.__file="Home.vue";var xt=jt.exports,Ot=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"fade"}},[n("div",{staticClass:"device-setup",on:{click:t.finish}},[t.loading?n("div",[t._v("loading...")]):[n("h1",[t._v("Device configuration")]),n("div",{staticClass:"help"},[t._v("Align the devices according to the grid. Tap on the corresponding grid cell "),n("b",[t._v("on each device")]),t._v(" to acknownledge the device placement.")]),n("div",{staticClass:"grid",style:t.gridStyle},t._l(t.devicePositions,function(e,i){var r=e.x,a=e.y,s=e.device;return n("div",{key:i,staticClass:"device",class:{selected:s,local:t.isLocal(r,a)},style:s&&t.deviceStyle(r,a,s),on:{click:function(e){e.stopPropagation(),t.select(r,a)}}},[s?[n("div",{staticClass:"screen"}),n("div",{staticClass:"button"},[t._v("⊚")])]:t._e()],2)}),0)]],2)])},Ct=[],Pt=.035,St={name:"DeviceSetup",props:{client:Object},data:function(){return{callbacks:null,deviceWidth:window.innerWidth,deviceHeight:window.innerHeight}},computed:Object(v["a"])({},Object(S["d"])(["id"]),{loading:function(){return!this.id}},Object(S["b"])(["bottom","findById","findByPosition","left","right","top","width"]),{device:function(){return this.findById(this.id)},devicePositions:function(){for(var t=[],e=this.top-1;e<this.bottom+2;++e)for(var n=this.left-1;n<this.right+2;++n)t.push({x:n,y:e,device:this.findByPosition(n,e)});return t},gridStyle:function(){return{gridTemplateColumns:"auto ".repeat(this.width+2)}},deviceStyle:function(){var t=this;return function(e,n,i){return{minWidth:"".concat(Math.round(Pt*i.deviceWidth),"mm"),minHeight:"".concat(Math.round(Pt*i.deviceHeight),"mm"),alignSelf:n>=(t.bottom+t.top)/2?"start":"end",justifySelf:e>=(t.right+t.left)/2?"start":"end"}}}}),mounted:function(){var t=this;window.onresize=function(){return t.updateDeviceInfo()},this.callbacks=this.client.createCallbacks(Object(j["a"])({$join:function(){return t.client.send("config:open")}},"config:finish",function(){return t.$router.push({name:"home"})})),this.client.send("config:open")},beforeDestroy:function(){delete window.onresize,this.client.resetCallbacks(this.callbacks)},methods:Object(v["a"])({},Object(S["c"])(["reset"]),{select:function(t,e){var n=this.findByPosition(t,e);if(n)n.id===this.id&&(this.$store.commit("deselect",this.id),this.$store.commit("removePlayers",this.id));else{var i=this.id,r=this.deviceWidth,a=this.deviceHeight;this.$store.commit("select",{x:t,y:e,id:i,deviceWidth:r,deviceHeight:a}),this.client.send("config:selection",this.$store.state.config.selection)}},isLocal:function(t,e){var n=this.findById(this.id);return n&&n.x===t&&n.y===e},finish:function(){this.$router.push({name:"home"}),this.client.send("config:finish")},updateDeviceInfo:function(){this.deviceWidth=window.innerWidth,this.deviceHeight=window.innerHeight}})},Mt=St,$t=(n("36a1"),Object(s["a"])(Mt,Ot,Ct,!1,null,"1ddf6b9c",null));$t.options.__file="DeviceSetup.vue";var Dt=$t.exports,Ft=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{staticClass:"session-form",on:{submit:function(e){return e.preventDefault(),t.joinSession(e)}}},[n("h1",[t._v("Achtung, die Kurve!")]),n("p",[t._v("Nulla nostrud tempor incididunt ad velit reprehenderit nulla eiusmod dolore sint aliquip voluptate enim ut id.")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],attrs:{type:"number",min:"0",placeholder:"0123",maxlength:"4"},domProps:{value:t.code},on:{input:function(e){e.target.composing||(t.code=e.target.value)}}}),n("input",{attrs:{type:"submit",disabled:4!==t.code.length,value:"Join session"}}),n("button",{on:{click:t.requestFullscreen}},[t._v("Go fullscreen")])])},Bt=[],At={props:{client:Object},data:function(){return{callbacks:null,code:""}},mounted:function(){var t=this;this.callbacks=this.client.createCallbacks({$connected:function(e,n){return t.$router.push({name:"home",params:{session:n}})}})},beforeDestroy:function(){this.client.resetCallbacks(this.callbacks)},methods:{joinSession:function(){this.client.join(this.code)},requestFullscreen:function(){document.body.requestFullscreen()}}},It=At,Ht=(n("b0a6"),n("c873"),Object(s["a"])(It,Ft,Bt,!1,null,"8ed1d6e0",null));Ht.options.__file="SessionForm.vue";var Et=Ht.exports;i["a"].use(d["a"]);var qt=function(t){return new d["a"]({mode:"history",base:"/achtung/",routes:[{path:"/",component:Et,props:{client:t}},{path:"/:session",name:"home",component:xt,props:{client:t},beforeEnter:function(e,n,i){/^\d{4}$/.test(e.params.session)?(t.session!==e.params.session&&t.join(e.params.session),i()):i("/")},children:[{path:"config",name:"config",component:Dt,props:{client:t}}]}]})},Wt=n("5176"),Rt=n.n(Wt),Lt=(n("7514"),function(t,e){return t.find(function(t){return t.id===e})}),Tt=function(t,e,n){return t.find(function(t){return t.x===e&&t.y===n})};function Nt(t,e){e.state.config.selection.length&&t.send("config:selection",e.state.config.selection)}function Gt(t,e){return Object(j["a"])({$join:function(){return Nt(t,e)},$left:function(t){return e.commit("deselect",t.id)}},"config:selection",function(t){return e.commit("setSelection",t)})}var zt=function(){return{state:{selection:[]},getters:{devices:function(t){var e=t.selection;return e},top:function(t){var e=t.selection;return e.length?Math.min.apply(Math,Object(x["a"])(e.map(function(t){var e=t.y;return e}))):0},left:function(t){var e=t.selection;return e.length?Math.min.apply(Math,Object(x["a"])(e.map(function(t){var e=t.x;return e}))):0},right:function(t){var e=t.selection;return e.length?Math.max.apply(Math,Object(x["a"])(e.map(function(t){var e=t.x;return e}))):0},bottom:function(t){var e=t.selection;return e.length?Math.max.apply(Math,Object(x["a"])(e.map(function(t){var e=t.y;return e}))):0},width:function(t,e){return 1+e.right-e.left},height:function(t,e){return 1+e.bottom-e.top},findById:function(t){var e=t.selection;return function(t){return Lt(e,t)}},findByPosition:function(t){var e=t.selection;return function(t,n){return Tt(e,t,n)}},columns:function(t){var e=t.selection;return e.reduce(function(t,e){var n=e.x,i=e.deviceWidth;return Rt()(t,Object(j["a"])({},n,Math.max(t[n]||0,i)))},{})},rows:function(t){var e=t.selection;return e.reduce(function(t,e){var n=e.y,i=e.deviceHeight;return Rt()(t,Object(j["a"])({},n,Math.max(t[n]||0,i)))},{})}},mutations:{reset:function(t){t.selection=[]},select:function(t,e){var n=e.x,i=e.y,r=e.id,a=e.deviceWidth,s=e.deviceHeight;t.selection=[].concat(Object(x["a"])(t.selection.filter(function(t){return t.id!==r})),[{x:n,y:i,id:r,deviceWidth:a,deviceHeight:s}])},deselect:function(t,e){t.selection=Object(x["a"])(t.selection.filter(function(t){return t.id!==e}))},setSelection:function(t,e){t.selection=e}}}},Jt=function(){function t(){Object(B["a"])(this,t)}return Object(A["a"])(t,null,[{key:"all",value:function(){for(var e=[],n=0;n<24;++n)e.push(t.get(n));return e}},{key:"get",value:function(t){return[{value:"#ff0000",name:"Red"},{value:"#00ff00",name:"Green"},{value:"#0000ff",name:"Blue"},{value:"#ffff00",name:"Yellow"},{value:"#00ffff",name:"Cyan"},{value:"#ff00ff",name:"Magenta"},{value:"#880000",name:"Shady Red"},{value:"#008800",name:"Shady Green"},{value:"#000088",name:"Shady Blue"},{value:"#888800",name:"Shady Yellow"},{value:"#008888",name:"Shady Cyan"},{value:"#880088",name:"Shady Magenta"},{value:"#440000",name:"Dark red"},{value:"#004400",name:"Dark green"},{value:"#000044",name:"Dark blue"},{value:"#444400",name:"Dark yellow"},{value:"#004444",name:"Dark cyan"},{value:"#440044",name:"Dark magenta"},{value:"#bb0000",name:"Light red"},{value:"#00bb00",name:"Light green"},{value:"#0000bb",name:"Light blue"},{value:"#bbbb00",name:"Light yellow"},{value:"#00bbbb",name:"Light cyan"},{value:"#bb00bb",name:"Light magenta"}][t%24]}}]),t}(),Ut=function(t,e){return C()(t).filter(function(n){return t[n].device_id===e})};function Yt(t){return C()(t.state.achtung.players).length}function Kt(t,e){var n=e.players;t.send("achtung:players",n)}function Xt(t,e){return Object(j["a"])({$join:function(){return Yt(e)&&Kt(t,e.state.achtung)},$left:function(t){return e.commit("removePlayers",t.id)}},"achtung:players",function(t){return e.commit("setPlayers",t)})}var Qt=function(t){return{state:{players:{},colors:Jt.all()},getters:{getPlayersForDevice:function(t){var e=t.players;return function(t){return Ut(e,t).map(function(t){return Rt()({player_id:t},e[t])})}}},mutations:{setPlayers:function(t,e){t.players=e},addPlayer:function(t,e){var n=t.players,r=t.colors,a=e.player_id,s=e.device_id,o=e.align,c=e.offset,l=r.splice(0,1),u=Object(P["a"])(l,1),d=u[0];i["a"].set(n,a,{device_id:s,align:o,offset:c,color:d})},removePlayer:function(t,e){var n=t.players,r=t.colors;r.push(n[e].color),i["a"].delete(n,e)},removePlayers:function(t,e){var n=t.players,r=t.colors;Ut(n,e).forEach(function(t){r.push(n[t].color),i["a"].delete(n,t)})}},actions:{addPlayer:function(e,n){var i=e.commit,r=e.state;i("addPlayer",n),Kt(t,r)},removePlayer:function(e,n){var i=e.commit,r=e.state;i("removePlayer",n),Kt(t,r)}}}};function Vt(t,e){var n=new URL(window.location),i=n.searchParams.get("title"),r=n.searchParams.get("text"),a=n.searchParams.get("url"),s={title:i,text:r,url:a};a&&(e.commit("setUrlParams",s),t.send("params",s))}function Zt(t,e){null!==e.state.params.url&&t.send("params",e.state.params)}function te(t,e){return Object(j["a"])({$connected:function(t,n){return e.commit("setId",{id:t,session:n})},$join:function(){return Zt(t,e)}},"params",function(t){return e.commit("setUrlParams",t)})}i["a"].use(S["a"]);var ee=function(t){var e=new S["a"].Store({modules:{config:zt(t),achtung:Qt(t)},state:{id:null,session:null,params:{title:null,text:null,url:null}},mutations:{setId:function(t,e){var n=e.id,i=e.session;t.id=n,t.session=i},setUrlParams:function(t,e){t.params=e}},getters:{title:function(t){var e=t.params;return e.title},text:function(t){var e=t.params;return e.text},url:function(t){var e=t.params;return e.url}}});return t.createCallbacks(te(t,e)),t.createCallbacks(Gt(t,e)),t.createCallbacks(Xt(t,e)),window.addEventListener("DOMContentLoaded",function(){return Vt(t,e)}),Vt(t,e),e},ne=n("e377"),ie=n.n(ne),re=function(){function t(){var e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(B["a"])(this,t),this.callbacks=[],this.socket=new ie.a({url:"https://webrtc.splits.link",debug:n,media:{},receiveMedia:{}}),this.id=null,this.socket.on("connectionReady",function(t){e.id=t}),this.socket.on("createdPeer",function(t){var n=t.getDataChannel("achtung");"open"!=n.readyState?t.on("channelOpen",function(i){i==n&&e.callbacks.forEach(function(e){return e.$join(t)})}):e.callbacks.forEach(function(e){return e.$join(t)})}),this.socket.on("peerStreamRemoved",function(t){e.callbacks.forEach(function(e){return e.$left(t)})}),this.session=null,this.socket.on("joinedRoom",function(t){e.session=t,e.callbacks.forEach(function(t){return t.$connected(e.id,e.session)})}),this.socket.on("channelMessage",function(t,n,i){var r=i.type,a=i.payload;"achtung"===n&&e.callbacks.forEach(function(t){return t[r]&&t[r](a)})})}return Object(A["a"])(t,[{key:"join",value:function(t){this.socket.leaveRoom(),this.socket.joinRoom(t)}},{key:"createCallbacks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=Rt()({},{$join:function(){},$left:function(){},$connected:function(){}},t),this.id&&this.session&&t.$connected(this.id,this.session),this.callbacks.push(t),t}},{key:"resetCallbacks",value:function(t){var e=this.callbacks.indexOf(t);e>=0&&this.callbacks.splice(e,1)}},{key:"send",value:function(t,e){this.socket.sendDirectlyToAll("achtung",t,e)}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),t}();i["a"].config.productionTip=!1;var ae=new re(0);new i["a"]({router:qt(ae),store:ee(ae),render:function(t){return t(l)}}).$mount("#app")},6406:function(t,e,n){},"64a9":function(t,e,n){},8724:function(t,e,n){"use strict";var i=n("331a"),r=n.n(i);r.a},"8a8b":function(t,e,n){"use strict";var i=n("31aa"),r=n.n(i);r.a},b0a6:function(t,e,n){"use strict";var i=n("bc78"),r=n.n(i);r.a},bc78:function(t,e,n){},c873:function(t,e,n){"use strict";var i=n("4ab0"),r=n.n(i);r.a},f717:function(t,e,n){},ffc2:function(t,e,n){"use strict";var i=n("6406"),r=n.n(i);r.a}});
//# sourceMappingURL=app.b8381f90.js.map